<!DOCTYPE html>
<html>
  <head>
    <title>Tabletops</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Bootstrap -->
<link href="css/bootstrap.css" rel="stylesheet" media="screen">
<link href="css/Site.css" rel="stylesheet" media="screen">
<link href="css/bootstrap-clockpicker.min.css" rel="stylesheet" >
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script	src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap-clockpicker.min.js"></script>
<script src="js/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>

<script type="text/javascript">
	$(document).ready(function() {
		$('#nav-container').load('nav.html');
		
		loadEventFromLocalStorage();
		
	});
</script>
</head>
  <body>
 
    <script type="text/javascript">
  function loadEventFromLocalStorage(){
	  var id = localStorage.event;
		if(id > 0){
			var clientUrl = "/SchoolRestJPA/rest/tabletopservices/events/" + id;
			
		 	$.ajax({
		 		type: 'GET',
		 		url: clientUrl,  
		 	    dataType: "json", 
		         success: function (data) {
		        	 //alert("success");
		        	 
		        	
		        	$("#inputEventID").val(id);
		        	$("#inputTitle").val(data.eventTitle);
 		         	
 		         	$("#inputRole").val(data.role);
 		         	$("#inputVenueName").val(data.venueName);
 		         	$("#inputEventDate").val(data.eventDateTime.monthValue+"/"+data.eventDateTime.dayOfMonth+"/"+data.eventDateTime.year);
 		         	$("#inputEventTime").val(data.eventDateTime.hour + ":" +data.eventDateTime.minute);
 		         	$("#inputTableEmptySpots").val(data.maxEmptySeats);
 		         	console.log(data.primaryPlanner.userID);
 		         	console.log(data.primaryPlanner.name);
 		         	$("#selectPrimaryPlanner").val(1).change();
 		         	$("#inputTableSize").val(data.eventTableSize);
 		         	if(data.client != null){
 		         		$("#selectClientName").val(data.client.clientID);	
 		         	}
 		         	
		         },
		         error: function (jqXHR, exception) {
		    	    
		     	    alert("Load Client Error" + jqXHR.responseText);
		     	  }  
		     });
		}
  }
  $(document).ready(function() { 
  	$("#editUserForm").submit(function(e){
	  e.preventDefault();
	  // Get form
      	var data = {};
    	var Form = this;
		
    	//Gathering the Data
    	//and removing undefined keys(buttons)
    	$.each(this.elements, function(i, v){
            var input = $(v);
        	data[input.attr("name")] = input.val();
        	
        	delete data["undefined"];
    	});
		
      $("#btnSubmit").prop("disabled", true);
      
      
	  var userID = $("#inputUserID").val();
	
	  if(userID > 0){
		  console.log(JSON.stringify(data));
		  var url =  "/SchoolRestJPA/rest/tabletopservices/users/" + userID;	  
			$.ajax({
	          type: "PUT",
	          url: url,
	          contentType: "application/json; charset=utf-8",
	          dataType:"json",
	          data: JSON.stringify(data),          
	          cache: false,
	          context : Form,
	          success: function (data) {             
	              $("#btnSubmit").prop("disabled", false);
	          },
	          error: function (e) {
	              console.log("ERROR : ", e.responseText);
	              $("#btnSubmit").prop("disabled", false);
	          }
	      });
	  }else{ //new client
		 
		  var url =  "/SchoolRestJPA/rest/tabletopservices/users/";	  
			$.ajax({
	          type: "POST",
	          url: url,
	          contentType: "application/json; charset=utf-8",
	          dataType:"json",
	          data: JSON.stringify(data),          
	          cache: false,
	          context : Form,
	          success: function (data) {             
	              $("#btnSubmit").prop("disabled", false);
	          },
	          error: function (e) {
	              console.log("ERROR : ", e.responseText);
	              $("#btnSubmit").prop("disabled", false);
	          }
	      });
	  }
	  
	  
  	});
  });
  function seatingArrangement(){
		localStorage.eventId = localStorage.event;
		document.location.href = "/StudentRest-HTML-JPA/WebContent/PlaceCards.html", true;  
		
	}
function loadPlanners(){
	  
// 	  $("select").change(function(){
// 		    alert($(this).find(":selected").data("value").age);
// 		});
		var Url = "/SchoolRestJPA/rest/tabletopservices/users/"
	  $.ajax({
	 		type: 'GET',
	 		url: Url,  
	 	    dataType: "json", 
	         success: function (data) {
	        	 //alert("success");
	        	 
	        	 $("#selectPrimaryPlanner").empty();
		         $("#selectPrimaryPlanner").append("<option value='0'>---Select Primary Planner---</option>");
		         $.each(data, function(i, user){
		        	 $("#selectPrimaryPlanner").append($("<option data-value=" + JSON.stringify(user) +" ></option>").val(user.userID).html(user.name));
		         });
	        	
	         },
	         error: function (jqXHR, exception) {
	    	    
	     	    alert("Load Client Error" + jqXHR.responseText);
	     	  }  
	     });
  		console.log("loading planners");
  }
  
  function loadClients(){
		var Url = "/SchoolRestJPA/rest/tabletopservices/clients/"
			  $.ajax({
			 		type: 'GET',
			 		url: Url,  
			 	    dataType: "json", 
			         success: function (data) {
			        	 //alert("success");
			        	 
			        	 $("#selectClientName").empty();
				         $("#selectClientName").append("<option value='0'>---Select Client---</option>");
				         $.each(data, function(i, client){
				        	 $("#selectClientName").append($("<option data-value=" + JSON.stringify(client) +" ></option>").val(client.clientID).html(client.name));
				         });
			        	
			         },
			         error: function (jqXHR, exception) {
			    	    
			     	    alert("Load Client Error" + jqXHR.responseText);
			     	  }  
			     });
  }
  
  
  </script>
   <script type="text/javascript">
  loadPlanners();
	loadClients();
  </script>
<!--   <select> -->
<!--     <option data-value='{"name":"rajiv","age":"40"}'>a</option> -->
<!--     <option data-value='{"name":"mithun","age":"22"}'>f</option> -->
<!-- </select> -->
  <div id="nav-container">

  </div>
    <div class="container">
	<div class="row">
	 <h2>Edit Event</h2>
	</div>
	<div class="row">
	<div class="pull-right">
		<a href="javascript:seatingArrangement()" class="btn btn-info btn-sm">Seating Arrangement</a>
	</div>
	</div>
		<div class="row">
			<div class="panel panel-primary">
				<div class="panel-heading">
					<h3 class="panel-title">Event Info</h3>
				</div>
				<div class="panel-body">

					<div class="row">
						<div class="col-sm-12 col-md-12 col-lg-12">
							<form class="form-horizontal">
								<fieldset>
									<input type="hidden" id="#inputEventID" name="eventId" val="" >
									<div class="form-group">
										<label for="inputEventTitle" class="col-lg-2 control-label">
											Event Title
										</label>
										<div class="col-lg-10">
											<input type="text" class="form-control" id="inputTitle" name="eventTitle"	placeholder="Event Title">
										</div>
									</div>
									<div class="form-group">
										<label for="inputVenueName" class="col-lg-2 control-label">
											Venue Name
										</label>
										<div class="col-lg-10">
											<input type="text" class="form-control" id="inputVenueName" name="venueName"
												placeholder="Venue Name">
										</div>
									</div>
									<div class="form-group">
										<label for="inputEventDate" class="col-lg-2 control-label">Event
											Date/Time</label>
										<div class="col-lg-10">
											<input type="datetime" class="form-control date-input" id="inputEventDate" name="EventDate" placeholder="Event Date/Time">
												<div class="input-group clockpicker" data-autoclose="true">
    												<input type="text" class="form-control" id="inputEventTime" name="inputEventTime" value="13:14">
    												<span class="input-group-addon">
        												<span class="glyphicon glyphicon-time"></span>
    												</span>
												</div>	
										</div>
									</div>
									<div class="form-group">
										<label for="selectClientName" class="col-lg-2 control-label">Client
											Name</label>
										<div class="col-lg-10">
											<select class="form-control" id="selectClientName" name="EventTime">
												<option>Albus Dumbledore</option>
												<option>Harry Potter</option>
												<option>Hedwig</option>
												<option>Severus Snape</option>
											</select>
										</div>
									</div>
									
									<div class="form-group">
										<label for="selectPrimaryPlanner"
											class="col-lg-2 control-label">Primary Planner</label>
										<div class="col-lg-10">
											<select class="form-control" id="selectPrimaryPlanner" name="primaryPlanner" >
												<option>Mary Christmas</option>
												<option>Sally Sassalot</option>
												<option>Wendy Whiner</option>
												<option>Patty Positive</option>
											</select>
										</div>
									</div>
									
									<div class="form-group">
										<label for="inputTableSize" class="col-lg-2 control-label">Table
											Size</label>
										<div class="col-lg-10">
											<input type="text" class="form-control" id="inputTableSize"
												placeholder="Table Size">
										</div>
									</div>
									
									<div class="form-group">
										<label for="inputTableEmptySpots"
											class="col-lg-2 control-label">Max Empty Seats</label>
										<div class="col-lg-10">
											<input type="text" class="form-control"
												id="inputTableEmptySpots" placeholder="Max Empty Seats">
										</div>
									</div>
							<div class="btn-group pull-right">
										<div class="col-md-12 col-lg-12 ">
											<button type="submit" class="btn btn-primary">Submit</button>
											<button type="reset" class="btn btn-default">Cancel</button>
										</div>
								</div>
								</fieldset>

							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		
		
		
		
		<div class="row">
			<div class="panel panel-primary">
				<div class="panel-heading">
					<h3 class="panel-title">Guests</h3>
				</div>
				<div class="panel-body">
					<div class="row">
						<a href="#" class="btn btn-xs btn-primary pull-right"><i class="glyphicon glyphicon-plus"></i>New Guest</a>
						<div class="form-inline">
							<div class="input-group input-group-sm">
								<input type="text" class="form-control"
									placeholder="Import from file">
								<div class="input-group-btn">
									<label class="btn btn-default btn-sm btn-file"> Browse
										<input type="file" style="display: none;">
									</label>
								</div>
							</div>
							<button class="btn btn-sm btn-success">Import</button>
						</div>
					</div>
						<hr>
					<div class="row">
						<table class="table table-striped table-hover ">
							<thead>
								<tr>
									<th>Name</th>
									<th>Relationship to Client</th>
								</tr>
							</thead>
							<tbody>
								<tr>

									<td>Bob Barker</td>
									<td>5th cousin thrice removed</td>
									 <td><a href="#">Edit</a>&nbsp;<a href="#">Delete</a></td>
								</tr>
								<tr>

									<td>Peter Piper</td>
									<td>Great Great Great Great Great Uncle</td>
									 <td><a href="#">Edit</a>&nbsp;<a href="#">Delete</a></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>

		</div>
	
	</div><!-- /.container -->
	
<!--     <script src="http://code.jquery.com/jquery.js"></script> -->
    <script type="text/javascript">
			$('.clockpicker').clockpicker();
			$(".date-input").datepicker();
	</script>
  </body>
</html>