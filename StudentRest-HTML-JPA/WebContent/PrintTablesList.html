<!DOCTYPE html>
<html>
<head>
<title>Tabletops</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Bootstrap -->
<link href="css/bootstrap.css" rel="stylesheet" media="all">
<link href="css/Site.css" rel="stylesheet" media="all">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script type="text/javascript">
	$(document).ready(function() {
		$('#nav-container').load('nav.html');
		localStorage.tablesNavSelect = "btnTableView";
		$('#tables-nav').load('TablesNav.html');
		loadUsersTable();
	});
</script>
</head>
<body>
	<script type="text/javascript">
		function loadUsersTable() {

			var id = localStorage.eventId;
			if (id > 0) {
				var guestsUrl = "/SchoolRestJPA/rest/tabletopservices/events/"
						+ id + "/guests";

				$
						.ajax({
							type : "GET",
							url : guestsUrl,
							dataType : "json",
							success : function(resp) {
								// we have the response  

								$('#guest_table')
										.html(
												'<thead><tr><th>Guest Name</th><th>Table</th></tr></thead>');

								var guests = [];
								var tableNums = [];

								$
										.each(
												resp,
												function(i, guest) {
													if (guest.eventTableNumber == null) {
														alert("No table for guest "
																+ guest.name);
													} else {
														if (guests[guest.eventTableNumber] == null) {
															guests[guest.eventTableNumber] = [];
															tableNums
																	.push(guest.eventTableNumber);
														}
														guests[guest.eventTableNumber]
																.push(guest);
													}
												});

								tableNums.sort();
								var table;

								for (var i = 0; i < tableNums.length; i++) {
									var key = tableNums[i];
									var table = '<div class="panel panel-primary">'
											+ '<div class="panel-heading">'
											+ '<h3 class="panel-title">Table '
											+ key
											+ '</h3></div>'
											+ '<div class="panel-body">'
											+ '<div class="row"><table class="table table-striped table-hover">'
											+ '<thead><tr><th>Guest Name</th></tr></thead><tbody>';
									var tableGuests = guests[key];
									for (var j = 0; j < tableGuests.length; j++) {
										guest = tableGuests[j];
										console.log(guest);
										table = table + "<tr>" + "<td>"
												+ guest.name + "</td></tr>";
									}
									table = table
											+ '</tbody></div></div></table></div>';
									$('#guest_tables').append(table);
								}
							},
							error : function(jqXHR, exception) {

								alert(jqXHR.responseText);
							}
						});
			}
		}
	</script>
	<div id="nav-container"></div>

	<div class="container">

		<div class="col-sm-12 col-md-12 col-lg-12">
			<h1>Seating Arrangement</h1>
			<div id="tables-nav"></div>
			<div class="container">
				<div class="row">
					<h1>Guests</h1>
					<button class="btn btn-xs btn-default pull-right" onclick="window.print();">Print</button>
				</div>
				<hr />
				<div class="row" id="guest_tables"></div>
			</div>
		</div>
	</div>
</body>
</html>