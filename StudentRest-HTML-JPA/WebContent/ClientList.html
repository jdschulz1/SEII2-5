<!DOCTYPE html>
<html>
  <head>
       <title>Tabletops</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.css" rel="stylesheet" media="screen">
    <link href="css/Site.css" rel="stylesheet" media="screen">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script type="text/javascript">
		$(document).ready(function() {
			$('#nav-container').load('nav.html');
			
			loadClientsTable();
		});
</script>
  </head>
 

 
<body>
<script type="text/javascript">
$('#clientsNav').addClass('active');
</script>
<script type="text/javascript">
function loadClientsTable(){
	 $.ajax({ 
		   type: "GET",  
	       url: "/SchoolRestJPA/rest/tabletopservices/clients",  
	       dataType: "json",  
	       success: function(resp){  
	         // we have the response  
	       
	         $('#clientsTable').html("");
	         var tableRow;
  
	         $.each(resp, function(i, client){
	        		
	        	    tableRow = 
	        	        "<tr>"
	        	            +"<td>" + client.name + "</td>"	        	  
							+"<td><a href=\"javascript:editClient(" + client.clientID + ")\">Edit</a>&nbsp;<a href=\"javascript:deleteClient(" + client.clientID + ")\">Delete</a></td>"
	        	        +"</tr>";
	        	       
	        	$('#clientsTable').append(tableRow);
	         });
	       },  
	       error: function (jqXHR, exception) {
	    	    
	    	    alert("Error Loading Clients");
	    	    console.log(jqXHR.responseText);
	    	  }  
		});
}

function editClient(id){
	localStorage.client = id;
	document.location.href = "/StudentRest-HTML-JPA/WebContent/EditClient.html", true;  
	
}

function deleteClient(id){
	var txt;
	var r = confirm("Are you sure you want to delete the Client?");
	if (r == true) {
	    txt = "Deleting Client!";
	//call to delete client service
	var url = "/SchoolRestJPA/rest/tabletopservices/clients/" + id;
	$.ajax({ 
		   type: "DELETE",  
	       url: url,  
	       dataType: "json",  
	       contentType: "application/json; charset=utf-8",
	       success: function(resp){  
	         // we have the response  
	       	 alert("Deleted Client");
	         $('#clientsTable').html("");
	         loadClientsTable();
	       },  
	       error: function (jqXHR, exception) {
	    	   alert("Error Deleting Client"); 
	    	   console.log(jqXHR.responseText);
	   
	    	  }  
		});
	//reload clientsTable after delete
	} else {
	    txt = "You pressed Cancel!";
	}
}
</script>
   <div id="nav-container">

  </div>  
  <div class="container">
      <div class="row"> 
    	 <h1>Clients</h1> 
      </div>
        <div class="row">
          
        	<a href="javascript:editClient(0)" class="btn btn-xs btn-primary pull-right"><i class="glyphicon glyphicon-plus"></i>New Client</a>
        </div>
        <div class="row">
        <table class="table table-striped table-hover ">
  <thead>
    <tr>
      
      <th>Client Name</th>
      <th>Actions</th>
      
    </tr>
  </thead>
  <tbody id="clientsTable">
   
      </tbody>
</table>
</div>
     
</div>

<!--     <script src="http://code.jquery.com/jquery.js"></script> -->
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
    $('#clientsNav').addClass('active');
    </script>
 </body>
</html>