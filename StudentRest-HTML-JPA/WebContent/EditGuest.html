<!DOCTYPE html>

<html>
  <head>
    <title>Tabletops</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Bootstrap -->
<link href="css/bootstrap.css" rel="stylesheet" media="screen">
<link href="css/Site.css" rel="stylesheet" media="screen">
<link href="css/bootstrap-clockpicker.min.css" rel="stylesheet" >
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<script	src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>


<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap-clockpicker.min.js"></script>
<script src="js/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
     <script type="text/javascript">
		$(document).ready(function() {
			$('#nav-container').load('nav.html');
			loadGuestFromLocalStorage();
			
		});
	</script>
  </head>
  <body>
  <div id="nav-container">

  </div>
  <script type="text/javascript">
  function loadGuestFromLocalStorage(){
	  var id = localStorage.editGuestId;
		if(id > 0){
			var Url = "/SchoolRestJPA/rest/tabletopservices/guests/" + id;
			
		 	$.ajax({
		 		type: 'GET',
		 		url: Url,  
		 	    dataType: "json", 
		         success: function (data) {
		        	 //alert("success");
		        	 
		        	 $("#inputGuestId").val(id);
		        	 $("#inputName").val(data.name);
		         	 $("#inputRelationship").val(data.clientRelationship);
		         
		         },
		         error: function (jqXHR, exception) {
		    	    
		     	    console.log("Load Guest Error" + jqXHR.responseText);
		     	  }  
		     });
		}
  }
  $(document).ready(function() { 
	  $("#btnCancel").click(function(e){
		  //event should be set in local storage still. 
		  document.location.href = "/StudentRest-HTML-JPA/WebContent/EditEvent.html", true;
			
		}); 
  	$("#editGuestForm").submit(function(e){
	  e.preventDefault();
	  // Get form
      	var data = {};
    	var Form = this;
		
    	//Gathering the Data
    	//and removing undefined keys(buttons)
    	$.each(this.elements, function(i, v){
            var input = $(v);
        	data[input.attr("name")] = input.val();
        	console.log(input.attr("name") + " " + input.val());
        	delete data["undefined"];
    	});
		console.log(JSON.stringify(data));
      $("#btnSubmit").prop("disabled", true);
      
      
	  var guestID = $("#inputGuestId").val();
	  if(guestID > 0){
		  var url =  "/SchoolRestJPA/rest/tabletopservices/guests/" + guestID;	  
			$.ajax({
	          type: "PUT",
	          url: url,
	          contentType: "application/json; charset=utf-8",
	          dataType:"json",
	          data: JSON.stringify(data),          
	          cache: false,
	          context : Form,
	          success: function (data) {             
	              $("#btnSubmit").prop("disabled", false);
	              alert("Guest Data Saved");
	              //event id should still be in local storage
	        	  document.location.href = "/StudentRest-HTML-JPA/WebContent/EditEvent.html", true;
	          },
	          error: function (e) {
	        	  alert("Error Saving Guest Data");
	              console.log("ERROR : ", e.responseText);
	              $("#btnSubmit").prop("disabled", false);
	          }
	      });
	  }else{ //new guest
		  var url =  "/SchoolRestJPA/rest/tabletopservices/guests/";	  
			$.ajax({
	          type: "POST",
	          url: url,
	          contentType: "application/json; charset=utf-8",
	          dataType:"json",
	          data: JSON.stringify(data),          
	          cache: false,
	          context : Form,
	          success: function (data) {             
	              $("#btnSubmit").prop("disabled", false);
	              alert("Guest Data Saved");
	        	  document.location.href = "/StudentRest-HTML-JPA/WebContent/EditEvent.html", true;
	          },
	          error: function (e) {
	        	  alert("Error Saving Guest Data");
	        	  console.log("ERROR : ", e.responseText);
	              $("#btnSubmit").prop("disabled", false);
	          }
	      });
	  }
	  
	  
  	});
  });
  
  function loadBlackList(){
	  
  }
  function loadWhiteList(){
	  
  }
  function addGuests(type){
	  var heading;
	  var guestName =  $("#inputName").val();
	  
	  if(type == 0){heading =  guestName + " White List";}
	  if(type == 1){heading = guestName + " Black List";}
	  localStorage.editListTypeId = type;
	  localStorage.editListTypeHeading = heading;
  }
  </script>
    <div class="container">


		<div class="row">
			<h1>Edit Guest</h1>
		</div>
		
		<div class="row">

			<form id="guestForm" class="form-horizontal">
				<div class="form-group">
				<input type="hidden" id="inputGuestId" name="guestId" value="">
					<label for="inputName" class="col-sm-2 col-md-2 col-lg-2 control-label">Name</label>
					<div class="col-sm-10 col-md-10 col-lg-10">
					 <input	type="text" class="form-control" name="name"  id="inputName" placeholder="Guest Name">
					</div>
				</div>
				<div class="form-group">
				
					<label for="inputComment" class="col-sm-2 col-md-2 col-lg-2 control-label">Client
						Relationship</label>
						
							<div class="col-sm-10 col-md-10 col-lg-10">
							 <input type="text" class="form-control" id="inputRelationship" name="clientRelationship" placeholder="Relationship to Client">
						</div>
				</div>
				<div class="btn-group pull-right">
					<div class="col-md-12 col-lg-12 ">
						<button type="submit" id="btnSubmit" class="btn btn-primary">Submit</button>
						<button type="reset" id="btnCancel" class="btn btn-default">Cancel</button>
					</div>
				</div>
			</form>
		</div>
	<hr />
	<!-- End of Guest form       -->

		<div class="row">
			<div class="panel panel-primary">
				<div class="panel-heading clearfix">
					<div class="pull-right">
						<div class="form-inline">
								<a href="javascript:addGuests(0)" ><i class="glyphicon glyphicon-plus"></i>Add Guest</a>
							
						</div>
					</div>
					<h3 class="panel-title">White List</h3>

				</div>
				<div class="panel-body">
					<table id="whiteListTable" class="table table-striped table-hover ">
						<thead>
							<tr>
								<th>Guest</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>Debbie Downer</td>
								<td><a href="#">Delete</a></td>

							</tr>
							<tr>
								<td>Wendy Whiner</td>
								<td><a href="#">Delete</a></td>
							</tr>
						</tbody>
					</table>

				</div>
			</div>
		</div>

		<div class="row">
			<div class="panel panel-primary">
				<div class="panel-heading clearfix">
					<div class="pull-right">
						<div class="form-inline">
							<div class="form-inline">
								<a href="javascript:addGuests(1)" ><i class="glyphicon glyphicon-plus"></i>Add Guest</a>
							</div>
						</div>
					</div>
					<h3 class="panel-title">Black List</h3>
				</div>
				<div class="panel-body">
					<table class="table table-striped table-hover ">
						<thead>
							<tr>
								<th>Guest</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody id="blackListTable">
							<tr>

								<td>Voldemort</td>
								<td><a href="#">Delete</a></td>

							</tr>
							<tr>

								<td>Dobby Smithss</td>
								<td><a href="#">Delete</a></td>
							</tr>
						</tbody>
					</table>

				</div>
			</div>
		</div>


	</div><!-- /.container -->
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>