<!DOCTYPE html>

<html>
  <head>
    <title>Tabletops</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.css" rel="stylesheet" media="screen">
    <link href="css/Site.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  </head>
  <script type="text/javascript">
		$(document).ready(function() {
			$('#nav-container').load('nav.html');
			loadClientFromLocalStorage();
		});
		
	</script>
  <body>
  <script type="text/javascript">
  
  function loadClientFromLocalStorage(){
	  var id = localStorage.client;
		if(id > 0){
			var clientUrl = "/SchoolRestJPA/rest/tabletopservices/clients/" + id;
			
		 	$.ajax({
		 		type: 'GET',
		 		url: clientUrl,  
		 	    dataType: "json", 
		         success: function (data) {
		        	 //alert("success");
		        	 $("#inputClientID").val(id);
		        	 $("#inputName").val(data.name);
		         	 $("#inputPhone").val(data.phoneNumber);
		         	 $("#inputEmail").val(data.email);
		         },
		         error: function (jqXHR, exception) {
		    	    
		     	    alert("Load Client Error" + jqXHR.responseText);
		     	  }  
		     });
		}
  }
  $(document).ready(function() { 
  	$("#editClientForm").submit(function(e){
	  e.preventDefault();
	  // Get form
      	var data = {};
    	var Form = this;
		
    	//Gathering the Data
    	//and removing undefined keys(buttons)
    	$.each(this.elements, function(i, v){
            var input = $(v);
        	data[input.attr("name")] = input.val();
        	console.log(input.attr("name") + " " + input.val());
        	delete data["undefined"];
    	});
		console.log(JSON.stringify(data));
      $("#btnSubmit").prop("disabled", true);
      
      
	  var clientID = $("#inputClientID").val();
	  if(clientID > 0){
		  var url =  "/SchoolRestJPA/rest/tabletopservices/clients/" + clientID;	  
			$.ajax({
	          type: "PUT",
	          url: url,
	          contentType: "application/json; charset=utf-8",
	          dataType:"json",
	          data: JSON.stringify(data),          
	          cache: false,
	          context : Form,
	          success: function (data) {             
	              $("#btnSubmit").prop("disabled", false);
	          },
	          error: function (e) {
	              console.log("ERROR : ", e.responseText);
	              $("#btnSubmit").prop("disabled", false);
	          }
	      });
	  }else{ //new client
		  var url =  "/SchoolRestJPA/rest/tabletopservices/clients/";	  
			$.ajax({
	          type: "POST",
	          url: url,
	          contentType: "application/json; charset=utf-8",
	          dataType:"json",
	          data: JSON.stringify(data),          
	          cache: false,
	          context : Form,
	          success: function (data) {             
	              $("#btnSubmit").prop("disabled", false);
	          },
	          error: function (e) {
	              console.log("ERROR : ", e.responseText);
	              $("#btnSubmit").prop("disabled", false);
	          }
	      });
	  }
	  
	  
  	});
  });
  </script>

    <div class="container">
  	<div id="nav-container">

  	</div>
		<div class="row">
			<h1>Edit Client</h1>
		</div>
		<div class="row">
		 	
<form method="post" id="editClientForm" class="form-horizontal">
  <fieldset>
  
    <div class="form-group">
    <input type="hidden" id="inputClientID" name="clientId" value=""></input>
      <label for="inputName" class="col-lg-2 control-label">Name</label>
      <div class="col-lg-10">
        <input type="text" class="form-control" id="inputName" name="name" placeholder="Client Name">
      </div>
    </div>
    <div class="form-group">
      <label for="inputPhone" class="col-lg-2 control-label">Phone</label>
      <div class="col-lg-10">
        <input type="text" class="form-control" id="inputPhone" name="phoneNumber" placeholder="Phone">
      </div>
    </div>
    <div class="form-group">
      <label for="inputEmail" class="col-lg-2 control-label">Email</label>
      <div class="col-lg-10">
        <input type="text" class="form-control" id="inputEmail" name="email" placeholder="Phone">
      </div>
    </div>
        <div class="form-group pull-right">
      	<div class="col-lg-10 col-lg-offset-2">
        <button type="submit" id="btnSubmit" class="btn btn-primary">Submit</button>
        <button type="reset" class="btn btn-default">Cancel</button>     
      </div>
    </div>
</fieldset>

</form>
	</div>
	</div><!-- /.container -->
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>